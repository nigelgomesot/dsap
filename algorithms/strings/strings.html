<!DOCTYPE html>
<html>
<head>
</head>
<body>

  <script type="text/javascript">
  // REF: https://github.com/Hemant-Jain-Author/Data-Structures-and-Algorithms-using-JavaScript/blob/master/String/StringAlgo.js
  // REF: https://github.com/gordonmzhu/jstinytest/blob/master/tinytest.js

  // TinyTest START
  var TinyTestHelpers = {
    renderStats: function(tests, failures) {
      let numberOfTests = Object.keys(tests).length;
      let successes = numberOfTests - failures;
      let summaryStr = 'Total Tests: ' + numberOfTests
              + ', Success: ' + successes
              + ', Failures: ' + failures;

      summaryEle = document.createElement('h1');
      summaryEle.textContent = summaryStr;
      document.body.appendChild(summaryEle);
    }
  };

  var TinyTest = {

    run: function(tests) {
      var failures = 0;
      for (var testName in tests) {
        var testAction = tests[testName];
        try {
          testAction.apply(this);
          console.log('%c' + testName, "color: green;");
        } catch (e) {
          failures++;
          console.groupCollapsed('%c' + testName, "color: red;");
          console.error(e.stack);
          console.groupEnd();
        }
      }
      setTimeout(function() { // Give document a chance to complete
        if (window.document && document.body) {
          document.body.style.backgroundColor = (failures == 0 ? '#99ff99' : '#ff9999');
          TinyTestHelpers.renderStats(tests, failures);
        }
      }, 0);
    },
  
    fail: function(msg) {
      throw new Error('fail(): ' + msg);
    },
  
    assert: function(value, msg) {
      if (!value) {
        throw new Error('assert(): ' + msg);
      }
    },
  
    assertEquals: function(expected, actual) {
      if (expected != actual) {
        throw new Error('assertEquals() "' + expected + '" != "' + actual + '"');
      }
    },
  
    assertStrictEquals: function(expected, actual) {
      if (expected !== actual) {
        throw new Error('assertStrictEquals() "' + expected + '" !== "' + actual + '"');
      }
    },

  };

  var fail         = TinyTest.fail.bind(TinyTest),
    assert       = TinyTest.assert.bind(TinyTest),
    assertEquals     = TinyTest.assertEquals.bind(TinyTest),
    eq         = TinyTest.assertEquals.bind(TinyTest),
    assertStrictEquals = TinyTest.assertStrictEquals.bind(TinyTest),
    tests        = TinyTest.run.bind(TinyTest);

  // TinyTest END

  console.clear();


  function matchExpression(expression, string) {
    return matchExpressionUtil(expression, string, 0, 0);
  }

  function matchExpressionUtil(exp, str, expIndex, strIndex) {
    const expLength = exp.length;
    const strLength = str.length;

    if ((expIndex === expLength) && (strIndex === strLength)) {
      return true;
    }

    if ((expIndex === expLength && strIndex !== strLength) ||
        (expIndex !== expLength && strIndex === strLength)) {
      return false;
    }

    if (exp[expIndex] === '?' || exp[expIndex] === str[strIndex]) {
      return matchExpressionUtil(exp, str, expIndex + 1, strIndex + 1);
    }

    if (exp[expIndex] === '*' ) {
      return  matchExpressionUtil(exp, str, expIndex + 1, strIndex) ||
              matchExpressionUtil(exp, str, expIndex, strIndex + 1) ||
              matchExpressionUtil(exp, str, expIndex + 1, strIndex + 1);
    }

    return false;
  }

  // TODO: convert string to codepoint
  function toLower(char) {
    const codePoint = char.codePointAt(0);

    if (codePoint >= 65 && codePoint <= (65 + 25)) {
      return String.fromCharCode(codePoint + 32);
    }

    return char;
  }

  function toUpper(char) {
    const codePoint = char.codePointAt(0);

    if (codePoint >= 97 && codePoint <= (97 + 25)) {
      return String.fromCharCode(codePoint - 32);
    }

    return char;
  }

  function isPermutation(str1, str2) {
    var count = new Array(256).fill(0);

    if (str1.length != str2.length) {
      return false;
    }

    for (let i = 0; i < str1.length; i++) {
      count[str1.charCodeAt(i)]++;
      count[str2.charCodeAt(i)]--;
    }

    for (let i = 0; i < str1.length; i++) {
      if (count[str1.charCodeAt(i)] !== 0) {
        return false;
      }
    }

    return true;
  }

  function isPalindrome(str) {
    let i = 0;
    let j = str.length - 1;

    while ((i < j) && str[i] === str[j]) {
      i++;
      j--;
    }

    return (i < j) ? false : true;
  }

  function reverseString(str) {
    let strArray = str.split('');
    reverseUtil(strArray);

    return strArray.join('');
  }

  function reverseUtil(array) {
    let i = 0;
    let j = array.length - 1;
    let temp;

    while (i < j) {
      temp = array[i];
      array[i] = array[j];
      array[j] = temp;
      i++;
      j--;
    }
  }

  function reverseSentence(sntc) {
    let sntcArray = sntc.split(' ');
    reverseUtil(sntcArray);

    return sntcArray.join(' ');
  }

  function getAnagrams(word) {
    let wordArray = word.split('');
    let result = [];

    getAnagramsUtil(wordArray, 0, wordArray.length - 1, result);

    return result;
  }

  function getAnagramsUtil(array, lower, upper, result) {
    if (lower === upper) {
      result.push(array.join(''));
    } else {
      for (let i = lower; i <= upper; i++) {
        swapArray(array, i, lower);
        getAnagramsUtil(array, lower + 1, upper, result);
        swapArray(array, i, lower);
      }
    }
  }

  function swapArray(array, index1, index2) {
    let temp;
    temp = array[index1];
    array[index1] = array[index2];
    array[index2] = temp;
  }

  // REF: https://www.geeksforgeeks.org/shuffle-a-given-array-using-fisher-yates-shuffle-algorithm/
  function shuffle(string) {
    let strArray = string.split('');

    for (let i = strArray.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * i + 1);

      const temp = strArray[i];
      strArray[i] = strArray[j];
      strArray[j] = temp;
    }

    return strArray.join('');
  }

  function binaryAdd(str1, str2) {
    let result = '';
    let digitSum = 0;
    let index1 = str1.length - 1;
    let index2 = str2.length - 1;

    while (index1 >= 0 || index2 >= 0 || digitSum == 1) {
      digitSum += (index1 >= 0 ? str1[index1] - '0' : 0);
      digitSum += (index2 >= 0 ? str2[index2] - '0' : 0);

      result = (digitSum % 2 - '0').toString() + result;

      digitSum = parseInt(digitSum / 2);

      index1--;
      index2--;
    }

    return result;
  }

  tests({
    'it performs regular expression match': function() {
      let isMatch = false;

      isMatch = matchExpression('hel?o', 'hello');
      eq(isMatch, true);

      isMatch = matchExpression('hello*', 'hello world');
      eq(isMatch, true);


      isMatch = matchExpression('h*d', 'hello world');
      eq(isMatch, true);
    },
    'it performs case conversion': function() {
      let result;

      result = toLower('S');
      eq(result, 's');

      result = toUpper('s');
      eq(result, 'S');
    },
    'it checks if strings are permutation of each other': function() {
      let isPermutationResult;

      isPermutationResult = isPermutation('apple', 'plepa');
      eq(isPermutationResult, true);

      isPermutationResult = isPermutation('appleb', 'plepaa');
      eq(isPermutationResult, false);
    },
    'it checks if string is a palindrome': function() {
      let isPalindromeResult;

      isPalindromeResult = isPalindrome('eolloe');
      eq(isPalindromeResult, true);

      isPalindromeResult = isPalindrome('bolloe');
      eq(isPalindromeResult, false);

      isPalindromeResult = isPalindrome('eollob');
      eq(isPalindromeResult, false);
    },
    'it reverses a string': function() {
      let actualResult = reverseString('hello');
      let expectedResult = 'olleh';

      eq(actualResult, expectedResult);
    },
    'it reverses a sentence': function() {
      let actualResult = reverseSentence('i love hello world');
      let expectedResult = 'world hello love i';

      eq(actualResult, expectedResult);
    },
    'it returns anagrams of a word': function() {
      let actualResult = getAnagrams('ABC');
      let expectedResult = [
        'ABC',
        'ACB',
        'BAC',
        'BCA',
        'CBA',
        'CAB'
      ];

      eq(actualResult.length, expectedResult.length);

      for (let i = 0; i < actualResult.length; i++) {
        eq(actualResult.includes(expectedResult[i]), true);
      }
    },
    'it shuffles a string': function() {
      let string = 'ABCDEF';

      let shuffledString = shuffle(string);
      let isShuffled = string !== shuffledString;

      eq(isShuffled, true);
    },
    'it adds binary strings': function() {
      let str1 = '1101';
      let str2 = '100';

      let actualResult = binaryAdd(str1, str2);

      let expectedResult = '10001';
      eq(actualResult, expectedResult);

      str1 = '1100011';
      str2 = '10';

      actualResult = binaryAdd(str1, str2);

      expectedResult = '1100101';
      eq(actualResult, expectedResult);
    }

  });
  </script>
</body>
</html>
