<!DOCTYPE html>
<html>
<head>
</head>
<body>

  <script type="text/javascript">
  // REF: https://github.com/Hemant-Jain-Author/Data-Structures-and-Algorithms-using-JavaScript/blob/master/String/StringAlgo.js
  // REF: https://github.com/gordonmzhu/jstinytest/blob/master/tinytest.js

  // TinyTest START
  var TinyTestHelpers = {
    renderStats: function(tests, failures) {
      let numberOfTests = Object.keys(tests).length;
      let successes = numberOfTests - failures;
      let summaryStr = 'Total Tests: ' + numberOfTests
              + ', Success: ' + successes
              + ', Failures: ' + failures;

      summaryEle = document.createElement('h1');
      summaryEle.textContent = summaryStr;
      document.body.appendChild(summaryEle);
    }
  };

  var TinyTest = {

    run: function(tests) {
      var failures = 0;
      for (var testName in tests) {
        var testAction = tests[testName];
        try {
          testAction.apply(this);
          console.log('%c' + testName, "color: green;");
        } catch (e) {
          failures++;
          console.groupCollapsed('%c' + testName, "color: red;");
          console.error(e.stack);
          console.groupEnd();
        }
      }
      setTimeout(function() { // Give document a chance to complete
        if (window.document && document.body) {
          document.body.style.backgroundColor = (failures == 0 ? '#99ff99' : '#ff9999');
          TinyTestHelpers.renderStats(tests, failures);
        }
      }, 0);
    },
  
    fail: function(msg) {
      throw new Error('fail(): ' + msg);
    },
  
    assert: function(value, msg) {
      if (!value) {
        throw new Error('assert(): ' + msg);
      }
    },
  
    assertEquals: function(expected, actual) {
      if (expected != actual) {
        throw new Error('assertEquals() "' + expected + '" != "' + actual + '"');
      }
    },
  
    assertStrictEquals: function(expected, actual) {
      if (expected !== actual) {
        throw new Error('assertStrictEquals() "' + expected + '" !== "' + actual + '"');
      }
    },

  };

  var fail         = TinyTest.fail.bind(TinyTest),
    assert       = TinyTest.assert.bind(TinyTest),
    assertEquals     = TinyTest.assertEquals.bind(TinyTest),
    eq         = TinyTest.assertEquals.bind(TinyTest),
    assertStrictEquals = TinyTest.assertStrictEquals.bind(TinyTest),
    tests        = TinyTest.run.bind(TinyTest);

  // TinyTest END

  console.clear();


  function matchExpression(expression, string) {
    return matchExpressionUtil(expression, string, 0, 0);
  }

  function matchExpressionUtil(exp, str, expIndex, strIndex) {
    const expLength = exp.length;
    const strLength = str.length;

    if ((expIndex === expLength) && (strIndex === strLength)) {
      return true;
    }

    if ((expIndex === expLength && strIndex !== strLength) ||
        (expIndex !== expLength && strIndex === strLength)) {
      return false;
    }

    if (exp[expIndex] === '?' || exp[expIndex] === str[strIndex]) {
      return matchExpressionUtil(exp, str, expIndex + 1, strIndex + 1);
    }

    if (exp[expIndex] === '*' ) {
      return  matchExpressionUtil(exp, str, expIndex + 1, strIndex) ||
              matchExpressionUtil(exp, str, expIndex, strIndex + 1) ||
              matchExpressionUtil(exp, str, expIndex + 1, strIndex + 1);
    }

    return false;
  }

  // TODO: convert string to codepoint
  function toLower(char) {
    const codePoint = char.codePointAt(0);

    if (codePoint >= 65 && codePoint <= (65 + 25)) {
      return String.fromCharCode(codePoint + 32);
    }

    return char;
  }

  function toUpper(char) {
    const codePoint = char.codePointAt(0);

    if (codePoint >= 97 && codePoint <= (97 + 25)) {
      return String.fromCharCode(codePoint - 32);
    }

    return char;
  }

  function isPermutation(str1, str2) {
    var count = new Array(256).fill(0);

    if (str1.length != str2.length) {
      return false;
    }

    for (let i = 0; i < str1.length; i++) {
      count[str1.charCodeAt(i)]++;
      count[str2.charCodeAt(i)]--;
    }

    for (let i = 0; i < str1.length; i++) {
      if (count[str1.charCodeAt(i)] !== 0) {
        return false;
      }
    }

    return true;
  }

  function isPalindrome(str) {
    let i = 0;
    let j = str.length - 1;

    while ((i < j) && str[i] === str[j]) {
      i++;
      j--;
    }

    return (i < j) ? false : true;
  }

  tests({
    'it performs regular expression match': function() {
      let isMatch = false;

      isMatch = matchExpression('hel?o', 'hello');
      eq(isMatch, true);

      isMatch = matchExpression('hello*', 'hello world');
      eq(isMatch, true);


      isMatch = matchExpression('h*d', 'hello world');
      eq(isMatch, true);
    },
    'it performs case conversion': function() {
      let result;

      result = toLower('S');
      eq(result, 's');

      result = toUpper('s');
      eq(result, 'S');
    },
    'it checks if strings are permutation of each other': function() {
      let isPermutationResult;

      isPermutationResult = isPermutation('apple', 'plepa');
      eq(isPermutationResult, true);

      isPermutationResult = isPermutation('appleb', 'plepaa');
      eq(isPermutationResult, false);
    },
    'it checks if string is a palindrome': function() {
      let isPalindromeResult;

      isPalindromeResult = isPalindrome('eolloe');
      eq(isPalindromeResult, true);

      isPalindromeResult = isPalindrome('bolloe');
      eq(isPalindromeResult, false);

      isPalindromeResult = isPalindrome('eollob');
      eq(isPalindromeResult, false);
    }

  });
  </script>
</body>
</html>
